# åŸºç¡€çŸ¥è¯†

<aside>
ğŸŒ ä»£ç åœ¨æ¯ä¸ªæ•™ç¨‹çš„å¼€å§‹

</aside>

# åˆå§‹åŒ–é¡¹ç›®

Hardhat é¡¹ç›®æ˜¯å®‰è£…äº†`hardhat`åŒ…å’Œ`hardhat.config.js`æ–‡ä»¶çš„ Node.js é¡¹ç›®ã€‚

- åˆå§‹åŒ–

```bash
yarn init -y
```

- å®‰è£…hardhat

```bash
yarn add --dev hardhat
```

è¿è¡Œyarn hardhatåˆ›å»ºé¡¹ç›®ï¼š

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled.png)

å¦‚æœé€‰æ‹©`Create an empty hardhat.config.js`ï¼Œé‚£ä¹ˆhardhatå°†åªåˆ›å»ºå¦‚ä¸‹æ–‡ä»¶ï¼š

```jsx
/** @type import('hardhat/config').HardhatUserConfig */
module.exports = {
  solidity: "0.8.9",
};
```

## é¡¹ç›®ç»“æ„

å¦‚æœæ‚¨é€‰æ‹©*`Create a JavaScript project`*ï¼Œä¸€ä¸ªç®€å•çš„é¡¹ç›®åˆ›å»ºå‘å¯¼ä¼šé—®æ‚¨ä¸€äº›é—®é¢˜ã€‚ä¹‹åï¼Œå‘å¯¼å°†åˆ›å»ºä¸€äº›ç›®å½•å’Œæ–‡ä»¶å¹¶å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹ã€‚è¿™äº›ä¾èµ–å…³ç³»ä¸­æœ€é‡è¦çš„æ˜¯****[Hardhat Toolbox](https://hardhat.org/hardhat-runner/plugins/nomicfoundation-hardhat-toolbox#hardhat-toolbox)****ï¼Œä¸€ä¸ªæ†ç»‘äº†å¼€å§‹ä½¿ç”¨ Hardhat æ‰€éœ€çš„æ‰€æœ‰ä¸œè¥¿çš„æ’ä»¶ã€‚

åˆå§‹åŒ–çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```jsx
contracts/
scripts/
test/
hardhat.config.js
```

è¿™äº›æ˜¯ Hardhat é¡¹ç›®çš„é»˜è®¤è·¯å¾„ã€‚

- `contracts/`æ˜¯åˆçº¦çš„æºæ–‡ä»¶
- `test/`æ˜¯ä½ çš„æµ‹è¯•çš„è„šæœ¬
- `scripts/`æ˜¯ç®€å•çš„è‡ªåŠ¨åŒ–è„šæœ¬

å¦‚æœæƒ³ç”¨è‡ªå®šä¹‰çš„è·¯å¾„ï¼Œè¯·æŸ¥çœ‹[è·¯å¾„é…ç½®éƒ¨åˆ†](%E9%85%8D%E7%BD%AE%20509445dbc74b443e8af4d3b773694ea7.md).

# ç¼–è¯‘åˆçº¦

è¦åœ¨ Hardhat é¡¹ç›®ä¸­ç¼–è¯‘åˆçº¦ï¼Œè¯·ä½¿ç”¨å†…ç½®`compile`ä»»åŠ¡ï¼š

```bash
yarn hardhat compile
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘åçš„å†…å®¹å°†ä¿å­˜åœ¨`artifacts/`ç›®å½•ä¸­ï¼Œæˆ–è€…æ‚¨é…ç½®çš„å·¥ä»¶è·¯å¾„ã€‚å¯ä»¥æŸ¥çœ‹[è·¯å¾„é…ç½®éƒ¨åˆ†](%E9%85%8D%E7%BD%AE%20509445dbc74b443e8af4d3b773694ea7.md)ï¼Œå­¦ä¹ å¦‚ä½•æ”¹å˜ç¼–è¯‘åçš„ä¿å­˜è·¯å¾„ã€‚å¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºè¯¥ç›®å½•ã€‚

åˆå§‹ç¼–è¯‘åï¼ŒHardhat å°†åœ¨æ‚¨ä¸‹æ¬¡ç¼–è¯‘æ—¶å°½é‡å‡å°‘å·¥ä½œé‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè‡ªä¸Šæ¬¡ç¼–è¯‘ä»¥æ¥æ‚¨æ²¡æœ‰æ›´æ”¹ä»»ä½•æ–‡ä»¶ï¼Œåˆ™ä¸ä¼šç¼–è¯‘ä»»ä½•å†…å®¹ï¼š

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%201.png)

## é…ç½®ç¼–è¯‘å™¨

å¦‚æœæ‚¨éœ€è¦è‡ªå®šä¹‰ Solidity ç¼–è¯‘å™¨é€‰é¡¹ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€šè¿‡é…ç½®`hardhat.config.js`ä¸­çš„`solidity`å­—æ®µã€‚Â ä½¿ç”¨æ­¤å­—æ®µçš„æœ€ç®€å•æ–¹æ³•æ˜¯è®¾ç½®ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼š

```tsx
module.exports = {
  solidity: "0.8.9",
};
```

æˆ‘ä»¬å»ºè®®åœ¨é…ç½®æ–‡ä»¶ä¸­ä¸€å®šè¦è®¾ç½®ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼Œä»¥é¿å…åœ¨å‘å¸ƒæ–°ç‰ˆæœ¬çš„ Solidity æ—¶å‡ºç°æ„å¤–è¡Œä¸ºæˆ–ç¼–è¯‘é”™è¯¯ã€‚

<aside>
â— Hardhat å°†è‡ªåŠ¨ä¸‹è½½`solc`æ‚¨è®¾ç½®çš„ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨ä½¿ç”¨ HTTP ä»£ç†ï¼Œåˆ™å¯èƒ½éœ€è¦å°†`HTTP_PROXY`æˆ–`HTTPS_PROXY`ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºä»£ç†çš„ URLã€‚

</aside>

æ›´å¤šé…ç½®ï¼š

```tsx
module.exports = {
  solidity: {
    version: "0.8.9",
    settings: {
      optimizer: {
        enabled: true,
        runs: 1000,
      },
    },
  },
};
```

å¦‚æœæ‚¨çš„ä»»ä½•åˆçº¦ä¸æ‚¨é…ç½®çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œåˆ™ Hardhat å°†æŠ›å‡ºé”™è¯¯ã€‚

# æµ‹è¯•åˆçº¦

[web3Study/hardhat-tutorial/hh-tt-02 at main Â· ChuXiaoYi/web3Study](https://github.com/ChuXiaoYi/web3Study/tree/main/hardhat-tutorial/hh-tt-02)

ç¼–è¯‘åˆçº¦åï¼Œä¸‹ä¸€æ­¥éœ€è¦ç¼–å†™ä¸€äº›æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯ä»–ä»¬æ˜¯å¦æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚

è¿™ä¸ªæ•™ç¨‹ä¼šä»‹ç»æ¨èçš„åœ¨hardhatä¸­æµ‹è¯•åˆçº¦çš„æ–¹æ³•ã€‚å®ƒä½¿ç”¨[ether.js](https://docs.ethers.io/v5/)è¿æ¥hardhatç½‘ç»œï¼Œç”¨[Mocha](https://mochajs.org/)å’Œ[Chai](https://www.chaijs.com/)æ¥æµ‹è¯•ã€‚ä»–ä¹Ÿç”¨äº†è‡ªå®šä¹‰çš„[Chai matcher](https://hardhat.org/hardhat-chai-matchers)å’Œ[hardhat Network Helpers](https://hardhat.org/hardhat-network-helpers)ä½¿å¾—ç¼–å†™æµ‹è¯•ä»£ç æ›´ç®€å•ã€‚è¿™äº›å·¥å…·åŒ…éƒ½æ˜¯Hardhat Toolboxæ’ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœä½ è·Ÿç€ä¸Šé¢çš„æ•™ç¨‹åœ¨æ“ä½œï¼Œé‚£ä¹ˆä½ å·²ç»å®‰è£…ä»–ä»¬äº†ã€‚

è™½ç„¶è¿™æ˜¯æˆ‘ä»¬æ¨èçš„æµ‹è¯•è®¾ç½®ï¼Œä½† Hardhat éå¸¸çµæ´»ï¼šæ‚¨å¯ä»¥è‡ªå®šä¹‰æ–¹æ³•æˆ–ä½¿ç”¨å…¶ä»–å·¥å…·é‡‡ç”¨å®Œå…¨ä¸åŒçš„è·¯å¾„ã€‚

## ****åˆå§‹è®¾ç½®****

é¡¹ç›®åˆå§‹åŒ–åï¼Œä¼šåœ¨çœ‹åˆ°`/test/Lock.js`æ–‡ä»¶ï¼Œè¿™é‡ŒåŒ…å«äº†ä¸€äº›ç¤ºä¾‹æµ‹è¯•ã€‚è¿™é‡Œå…ˆå¿½ç•¥å®ƒï¼Œåˆ›å»ºä¸€ä¸ª`/test/my-tests.js`æ–‡ä»¶

## ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç”¨ä¾‹

è¿™é‡Œå°†ä¸º`Lock`åˆçº¦ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ¥å¾—åŠçœ‹åˆçº¦å†…å®¹ï¼Œå¯ä»¥å…ˆåˆ°`/contracts/Lock.sol`æŸ¥çœ‹åˆçº¦ã€‚

åœ¨è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†éƒ¨ç½²Lockåˆçº¦ï¼Œå¹¶ä¸”æ–­è¨€`unlockTime`å’Œæ„é€ å‡½æ•°ä¼ é€’çš„`_unlockTime`æ—¶é—´ç›¸åŒï¼š

```tsx
const { expect } = require("chai");
const hre = require("hardhat");
const { time } = require("@nomicfoundation/hardhat-network-helpers");

describe("Lock", function () {
  it("Should set the right unlockTime", async function () {
    const lockedAmount = 1_000_000_000;
    const ONE_YEAR_IN_SECS = 365 * 24 * 60 * 60;
    const unlockTime = (await time.latest()) + ONE_YEAR_IN_SECS;

    // deploy a lock contract where funds can be withdrawn
    // one year in the future
    const Lock = await hre.ethers.getContractFactory("Lock");
    const lock = await Lock.deploy(unlockTime, { value: lockedAmount });

    // assert that the value is correct
    expect(await lock.unlockTime()).to.equal(unlockTime);
  });
});
```

é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥éœ€è¦ç”¨çš„å·¥å…·åŒ…ï¼š`expect`ç”¨æ¥å†™æ–­è¨€ï¼Œ`hre`å’Œ`hardhat-network-helpers`ä½œç”¨äºhardhatç½‘ç»œã€‚ç„¶åä½¿ç”¨`describe`å’Œ`it`æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å…¨å±€`[Macha](https://mochajs.org/#getting-started)`æ–¹æ³•ï¼Œç”¨æ¥æè¿°å’Œç»„åˆæµ‹è¯•ç”¨ä¾‹çš„ã€‚

æµ‹è¯•ç”¨ä¾‹å…¶å®æ˜¯itå‡½æ•°å›è°ƒå‚æ•°é‡Œé¢çš„å†…å®¹ã€‚é¦–å…ˆå®šä¹‰å˜é‡`lockedAmount`ï¼ˆç”¨æ¥è¡¨ç¤ºlockçš„é‡‘é¢ï¼‰å’Œ`unlockTime`ã€‚`time.latest()`è¡¨ç¤ºæœ€åä¸€ä¸ªè¢«æŒ–å‡ºçš„åŒºå—çš„æ—¶é—´æˆ³ã€‚ç„¶åéƒ¨ç½²åˆçº¦ï¼šé¦–å…ˆè·å–`Lock`åˆçº¦ï¼Œç„¶åéƒ¨ç½²å®ƒï¼Œå°†unlockTimeä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ä¼ é€’è¿›å»ï¼Œå¹¶ä¸”ä¼ é€’äº†ä¸€ä¸ªå¸¦æœ‰äº¤æ˜“ä¿¡æ¯çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯å¯é€‰çš„ï¼Œè¿™é‡Œè®¾ç½®`value`å­—æ®µæ¥å‘é€ETHã€‚

æœ€åæˆ‘ä»¬æ£€æŸ¥åˆçº¦è¿”å›çš„`unlockTime`å’Œéƒ¨ç½²æ—¶ä¼ å…¥çš„`unlockTime`æ˜¯å¦ç›¸ç­‰ã€‚åˆçº¦é‡Œçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨`await`å…³é”®å­—æ¥è·å–å€¼ï¼Œå¦åˆ™æˆ‘ä»¬å°†ä¼šæ¯”è¾ƒ`promise`å¯¹è±¡å’Œæ•°å­—ï¼Œè¿™æ ·æ°¸è¿œéƒ½æ˜¯é”™è¯¯çš„ã€‚

## æµ‹è¯•ä¸€ä¸ªä¼šå›æ»šçš„å‡½æ•°

åœ¨ä¸Šä¸€ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†getteræ–¹æ³•æ˜¯å¦è¿”å›çš„æ˜¯æ­£ç¡®å€¼ã€‚getteræ˜¯ä¸€ä¸ªåªè¯»æ–¹æ³•ï¼Œè°ƒç”¨çš„æ—¶å€™å¹¶ä¸ä¼šæ”¯ä»˜è´¹ç”¨ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•é£é™©ã€‚ä½†æ˜¯å…¶ä»–èƒ½æ”¹å˜åˆçº¦çŠ¶æ€çš„æ–¹æ³•ï¼Œä¾‹å¦‚åˆçº¦ä¸­çš„withdrawæ–¹æ³•ã€‚æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸€äº›å‰ææ¡ä»¶æ‰èƒ½æˆåŠŸè°ƒç”¨æ­¤å‡½æ•°ã€‚å¦‚æœæ‚¨æŸ¥çœ‹å®ƒçš„ç¬¬ä¸€è¡Œï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€äº›`require`ç”¨äºæ­¤ç›®çš„çš„æ£€æŸ¥ï¼š

```solidity
function withdraw() public {
    ...

    require(block.timestamp >= unlockTime, "You can't withdraw yet");
    require(msg.sender == owner, "You aren't the owner");
		...
}
```

ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦åˆ°è¾¾äº†unlockTimeï¼Œç¬¬äºŒä¸ªè¡¨è¾¾å¼æ˜¯æ£€æŸ¥è°ƒç”¨è€…æ˜¯ä¸æ˜¯åˆçº¦æ‹¥æœ‰è€…ã€‚ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥æµ‹è¯•ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç»§ç»­åœ¨`/test/my-tests.js`ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```tsx
it("Should revert with the right error if called too soon", async function () {
    const lockedAmount = 1_000_000_000;
    const ONE_YEAR_IN_SECS = 365 * 24 * 60 * 60;
    const unlockTime = (await time.latest()) + ONE_YEAR_IN_SECS;

    // deploy a lock contract where funds can be withdrawn
    // one year in the future
    const Lock = await hre.ethers.getContractFactory("Lock");
    const lock = await Lock.deploy(unlockTime, { value: lockedAmount });

    // assert withdraw
    await expect(lock.withdraw()).to.be.revertedWith("You can't withdraw yet");
  });
```

ä¸Šä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`.to.equal`ï¼Œå®ƒæ˜¯`Chai`çš„ä¸€éƒ¨åˆ†ï¼Œè¢«ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†`.to.be.revertedWith`ï¼Œæ–­è¨€è¿™ä¸ªäº¤æ˜“ä¼šå›æ»šï¼Œå¹¶ä¸”å›æ»šçš„åŸå› å’Œç»™å®šçš„å­—ç¬¦ä¸²ç›¸ç­‰ã€‚

è¯·æ³¨æ„ï¼Œåœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­æˆ‘ä»¬å†™äº†`expect(await ...)`ä½†ç°åœ¨æˆ‘ä»¬çš„å†™æ³•æ˜¯`await expect(...)`ã€‚åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»¥åŒæ­¥æ–¹å¼æ¯”è¾ƒä¸¤ä¸ªå€¼ï¼›å†…éƒ¨ await å°±åœ¨é‚£é‡Œç­‰å¾…æ£€ç´¢å€¼ã€‚åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œæ•´ä¸ªæ–­è¨€æ˜¯å¼‚æ­¥çš„ï¼Œå› ä¸ºå®ƒå¿…é¡»ç­‰åˆ°äº¤æ˜“è¢«æŒ–å‡ºæ¥ã€‚è¿™æ„å‘³ç€`expect`è°ƒç”¨è¿”å›ä¸€ä¸ªæˆ‘ä»¬å¿…é¡»ç­‰å¾…çš„`promise`ã€‚

## æµ‹è¯•unlockTime

åœ¨éƒ¨ç½²åˆçº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®šä¹‰unlockTimeä¸º1å¹´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥æ£€æŸ¥è§£é”æ—¶é—´è¿‡åä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸èƒ½ç­‰å¾…1å¹´å†å»æµ‹è¯•ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®æ›´çŸ­çš„è§£é”æ—¶é—´ï¼Œæ¯”å¦‚5ç§’ï¼Œä½†æ˜¯è¿™åœ¨å®é™…æµ‹è¯•ä¸­ä¹Ÿéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚

è§£å†³æ–¹æ¡ˆæ˜¯æ¨¡æ‹Ÿæ—¶é—´çš„æµé€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`[time.increaseTo](https://hardhat.org/hardhat-network-helpers/docs/reference#increaseto(timestamp))`ï¼Œå®ƒä¼šç”¨ç»™å®šçš„æ—¶é—´æˆ³å»æŒ–ä¸€ä¸ªæ–°åŒºå—ï¼š

```tsx
it("Should transfer the funds to the owner", async function () {
    const lockedAmount = 1_000_000_000;
    const ONE_YEAR_IN_SECS = 365 * 24 * 60 * 60;
    const unlockTime = (await time.latest()) + ONE_YEAR_IN_SECS;

    // deploy a lock contract where funds can be withdrawn
    // one year in the future
    const Lock = await hre.ethers.getContractFactory("Lock");
    const lock = await Lock.deploy(unlockTime, { value: lockedAmount });

    await time.increaseTo(unlockTime);

    // this will throw if the transaction reverts
    await lock.withdraw();
  });
```

## æµ‹è¯•ä¸åŒåœ°å€

`withdraw`å‡½æ•°æ‰€åšçš„ç¬¬äºŒé¡¹æ£€æŸ¥æ˜¯è¯¥å‡½æ•°æ˜¯ç”±åˆçº¦æ‰€æœ‰è€…è°ƒç”¨çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œéƒ¨ç½²å’Œå‡½æ•°è°ƒç”¨é¦–å…ˆå®Œæˆå¸æˆ·é…ç½®.Â å¦‚æœæˆ‘ä»¬æƒ³æ£€æŸ¥æ˜¯å¦åªæœ‰æ‰€æœ‰è€…å¯ä»¥è°ƒç”¨æŸäº›å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸åŒçš„å¸æˆ·æ¥éªŒè¯å®ƒæ˜¯å¦å¤±è´¥ã€‚

`ethers.getSigners()`è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²é…ç½®å¸æˆ·çš„æ•°ç»„ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸åŒçš„è´¦æˆ·è°ƒç”¨åˆçº¦çš„`.connect`æ–¹æ³•è°ƒç”¨æ¥æ£€æŸ¥äº¤æ˜“æ˜¯å¦ä¼šå›æ»šï¼š

```tsx
it("Should revert with the right error if called from another account", async function () {
    const lockedAmount = 1_000_000_000;
    const ONE_YEAR_IN_SECS = 365 * 24 * 60 * 60;
    const unlockTime = (await time.latest()) + ONE_YEAR_IN_SECS;

    // deploy a lock contract where funds can be withdrawn
    // one year in the future
    const Lock = await hre.ethers.getContractFactory("Lock");
    const lock = await Lock.deploy(unlockTime, { value: lockedAmount });
  
    const [owner, otherAccount] = await ethers.getSigners();
  
    // we increase the time of the chain to pass the first check
    await time.increaseTo(unlockTime);
  
    // We use lock.connect() to send a transaction from another account
    await expect(lock.connect(otherAccount).withdraw()).to.be.revertedWith(
      "You aren't the owner"
    );
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°å¹¶æ–­è¨€å®ƒè¿”å›æ­£ç¡®çš„åŸå› å­—ç¬¦ä¸²ã€‚ä¸åŒä¹‹å¤„åœ¨äºæˆ‘ä»¬æ˜¯ä½¿ç”¨ä¸åŒçš„åœ°å€æ¥ä½¿ç”¨`.connect(anotherAccount)`æ¥è°ƒç”¨`withdraw`ã€‚

## ç»Ÿä¸€é‡å¤ä»£ç 

é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å‘ç°ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ä¼šå†™ä¸€ééƒ¨ç½²åˆçº¦çš„ä»£ç ã€‚åœ¨Mochaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`beforeEach`æ¥å¤„ç†ï¼Œåªéœ€è¦å†™ä¸€æ¬¡ï¼Œä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹é‡Œé¢å•ç‹¬éƒ¨ç½²ï¼š

```tsx
describe("Lock", function () {
  let lock;
  let unlockTime;
  let lockedAmount = 1_000_000_000;

  beforeEach(async function () {
    const ONE_YEAR_IN_SECS = 365 * 24 * 60 * 60;
    unlockTime = (await helpers.time.latest()) + ONE_YEAR_IN_SECS;

    const Lock = await ethers.getContractFactory("Lock");
    lock = await Lock.deploy(unlockTime, { value: lockedAmount });
  });

  it("some test", async function () {
    // use the deployed contract
  });
});
```

ä½†æ˜¯ä½¿ç”¨è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š

- å¦‚æœä½ éœ€è¦éƒ¨ç½²å¾ˆå¤šåˆåŒï¼Œä½ çš„æµ‹è¯•ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºåœ¨beforeEachä¸­æ¯ä¸ªåˆåŒä¸å¾—ä¸å‘é€å¾ˆå¤šæ¬¡äº¤æ˜“ã€‚
- beforeEachä¸­çš„å…±äº«å˜é‡æ˜¯ä¸‘é™‹ä¸”å®¹æ˜“å‡ºé”™çš„ã€‚

`loadFixture`å¯ä»¥åŒæ—¶è§£å†³ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜ã€‚`loadFixture`æ¥æ”¶ä¸€ä¸ª*`fixture`*ï¼ˆä¸€ä¸ªå°†é“¾è®¾ç½®ä¸ºæŸä¸ªæ‰€éœ€çŠ¶æ€çš„å‡½æ•°ï¼‰ã€‚å½“ç¬¬ä¸€æ¬¡æ‰§è¡Œ`loadFixture`æ—¶ï¼Œ*`fixture`*è¢«æ‰§è¡Œã€‚ä½†æ˜¯loadFixtureç¬¬äºŒæ¬¡æ‰§è¡Œæ—¶ï¼Œä¸ä¼šå†æ¬¡æ‰§è¡Œ *`fixture`*ï¼Œè€Œæ˜¯å°†ç½‘ç»œçŠ¶æ€é‡ç½®ä¸ºæ‰§è¡Œ *`fixture`* ä¹‹åçš„çŠ¶æ€ã€‚è¿™æ ·é€Ÿåº¦æ›´å¿«ï¼Œå¹¶ä¸”å®ƒä¼šæ’¤æ¶ˆä¹‹å‰æµ‹è¯•æ‰€åšçš„ä»»ä½•çŠ¶æ€æ›´æ”¹ã€‚æˆ‘ä»¬æ¥å°†å‰é¢çš„æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹æˆä»¥ä¸‹æ ·å­ï¼š

```tsx
const { expect } = require("chai");
const hre = require("hardhat");
const {
  time,
  loadFixture,
} = require("@nomicfoundation/hardhat-network-helpers");

describe("Lock", function () {
  async function deployOneYearLockFixture() {
    const lockedAmount = 1_000_000_000;
    const ONE_YEAR_IN_SECS = 365 * 24 * 60 * 60;
    const unlockTime = (await time.latest()) + ONE_YEAR_IN_SECS;

    const Lock = await ethers.getContractFactory("Lock");
    const lock = await Lock.deploy(unlockTime, { value: lockedAmount });

    return { lock, unlockTime, lockedAmount };
  }

  it("Should set the right unlockTime", async function () {
    const { lock, unlockTime } = await loadFixture(deployOneYearLockFixture);

    // assert that the value is correct
    expect(await lock.unlockTime()).to.equal(unlockTime);
  });

  it("Should revert with the right error if called too soon", async function () {
    const { lock } = await loadFixture(deployOneYearLockFixture);

    await expect(lock.withdraw()).to.be.revertedWith("You can't withdraw yet");
  });

  it("Should transfer the funds to the owner", async function () {
    const { lock, unlockTime } = await loadFixture(deployOneYearLockFixture);

    await time.increaseTo(unlockTime);

    // this will throw if the transaction reverts
    await lock.withdraw();
  });

  it("Should revert with the right error if called from another account", async function () {
    const { lock, unlockTime } = await loadFixture(deployOneYearLockFixture);

    const [owner, otherAccount] = await ethers.getSigners();

    // we increase the time of the chain to pass the first check
    await time.increaseTo(unlockTime);

    // We use lock.connect() to send a transaction from another account
    await expect(lock.connect(otherAccount).withdraw()).to.be.revertedWith(
      "You aren't the owner"
    );
  });
});
```

## å…¶ä»–æµ‹è¯•

æŸ¥çœ‹`test/Lock.js`æ–‡ä»¶äº†è§£å…¶ä»–æµ‹è¯•ç”¨ä¾‹

## æµ‹è¯•ä»£ç è¦†ç›–ç‡

åªéœ€è¿è¡Œ`coverage`ä»»åŠ¡ï¼Œæ‚¨å°±ä¼šå¾—åˆ°ä¸€ä»½æŠ¥å‘Šï¼š

```tsx
yarn hardhat coverage
```

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%202.png)

## gas-reporteræµ‹è¯•gasä½¿ç”¨é‡

æ ¹æ®æµ‹è¯•çš„æ‰§è¡Œè·å–ä½¿ç”¨äº†å¤šå°‘ gasï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š

- `REPORT_GAS=true yarn hardhat test`
- åœ¨`hardhat.config.js`æ–‡ä»¶ä¸­å¢åŠ ï¼š

```tsx
...
require("hardhat-gas-reporter");

/** @type import('hardhat/config').HardhatUserConfig */
module.exports = {
  ...
  gasReporter: {
    enabled: true,
  },
	...
};
```

## å¹¶è¡Œæµ‹è¯•

```tsx
yarn hardhat test --parallel
```

æˆ–åœ¨`hardhat.config.js`æ–‡ä»¶ä¸­å¢åŠ ï¼š

```tsx
9...

/** @type import('hardhat/config').HardhatUserConfig */
module.exports = {
  ...
  mocha: {
    parallel: true,
  },
...
};
```

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸²è¡Œæˆ–å¹¶è¡Œè·‘æµ‹è¯•ç”¨ä¾‹ä¼šäº§ç”Ÿç›¸åŒæ•ˆæœï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¹¶è¡Œè¿è¡Œçš„æµ‹è¯•ä¼šè¡¨ç°ä¸åŒï¼š

- ä¸²è¡Œæ¨¡å¼ä¸‹æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å…±äº«ä¸€ä¸ªHRE(Hardhat Runtime Environment)ï¼Œä½†æ˜¯å¹¶è¡ŒçŠ¶æ€ä¸‹ä¸æ˜¯ã€‚Mochaä½¿ç”¨ä¸€ç»„workeræ¥æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæ¯ä¸ª workeréƒ½æœ‰è‡ªå·±çš„HREå®ä¾‹ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªæµ‹è¯•æ–‡ä»¶éƒ¨ç½²äº†åˆçº¦ï¼Œé‚£ä¹ˆè¯¥éƒ¨ç½²ä¼šå­˜åœ¨äºå½“å‰è¿™ä¸ªworkderæ‰€å±çš„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œè€Œä¸ä¼šå­˜åœ¨äºå…¶ä»–workerçš„æµ‹è¯•æ–‡ä»¶ä¸­ã€‚
- `.only`ä¿®æ”¹å™¨åœ¨å¹¶è¡Œæ¨¡å¼ä¸‹ä¸èµ·ä½œç”¨ã€‚ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒ`--grep`æ¥è¿è¡Œç‰¹å®šæµ‹è¯•ï¼ˆ`yarn hardhat test test/my-tests.js --grep revert`ï¼‰ï¼Œå®ƒåªä¼šæŸ¥æ‰¾æè¿°ä¸­åŒ…å«`grep`åé¢è¯è¯­çš„æµ‹è¯•ç”¨ä¾‹æ¥æ‰§è¡Œã€‚
- ç”±äºå¹¶è¡Œæ¨¡å¼ä½¿ç”¨æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œå•ä¸ªæµ‹è¯•çš„æŒç»­æ—¶é—´å¯èƒ½ä¼šæ›´é•¿ï¼Œå› æ­¤æŸäº›æµ‹è¯•å¯èƒ½ä¼šå› æ­¤å¼€å§‹è¶…æ—¶ã€‚å¦‚æœé‡åˆ°æ­¤é—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ Hardhat é…ç½®çš„ Mocha éƒ¨åˆ†æˆ–åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å¢åŠ æµ‹è¯•è¶…æ—¶`this.timeout()`
- æ‰§è¡Œæµ‹è¯•çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚

è¿˜æœ‰ä¸€äº›ä¸å¹¶è¡Œæ¨¡å¼ç›¸å…³çš„å…¶ä»–é™åˆ¶ã€‚æ‚¨å¯ä»¥åœ¨ Mocha çš„æ–‡æ¡£ä¸­é˜…è¯»æ›´å¤šå…³äºå®ƒä»¬çš„ä¿¡æ¯ã€‚å¦‚æœæ‚¨åœ¨ä½¿ç”¨å¹¶è¡Œæ¨¡å¼æ—¶é‡åˆ°é—®é¢˜ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä»–ä»¬çš„å¹¶è¡Œæ¨¡å¼æ•…éšœæ’é™¤éƒ¨åˆ†ã€‚

# éƒ¨ç½²åˆçº¦

[web3Study/hardhat-tutorial/hh-tt-02 at main Â· ChuXiaoYi/web3Study](https://github.com/ChuXiaoYi/web3Study/tree/main/hardhat-tutorial/hh-tt-02)

ç›®å‰hardhatæ”¯æŒä¸¤ç§éƒ¨ç½²åˆçº¦çš„ç¼–å†™æ–¹å¼ï¼š

- ä½¿ç”¨`scripts/deploy.js`ä¸­çš„ç¤ºä¾‹
- ä½¿ç”¨[hardhat-deploy](https://github.com/wighawag/hardhat-deploy/tree/master)æ’ä»¶

åœ¨æœ¬åœ°ç½‘ç»œéƒ¨ç½²ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š

1. å¼€å¯æœ¬åœ°èŠ‚ç‚¹ï¼š`yarn hardhat node`
2. æ‰“å¼€æ–°ç»ˆç«¯ï¼Œå¹¶ä¸”è¿è¡Œdeployè„šæœ¬ï¼š`yarn hardhat run --network localhost scripts/deploy.js`

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%203.png)

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%204.png)

# éªŒè¯åˆçº¦

[web3Study/hardhat-tutorial/hh-tt-02 at main Â· ChuXiaoYi/web3Study](https://github.com/ChuXiaoYi/web3Study/tree/main/hardhat-tutorial/hh-tt-02)

åˆåŒå‡†å¤‡å°±ç»ªåï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å°†å…¶éƒ¨ç½²åˆ°çœŸå®ç½‘ç»œå¹¶éªŒè¯å…¶æºä»£ç ã€‚

éªŒè¯åˆçº¦æ„å‘³ç€å…¬å¼€å…¶æºä»£ç ä»¥åŠæ‚¨ä½¿ç”¨çš„ç¼–è¯‘å™¨è®¾ç½®ï¼Œè¿™å…è®¸ä»»ä½•äººç¼–è¯‘å®ƒå¹¶å°†ç”Ÿæˆçš„å­—èŠ‚ç ä¸éƒ¨ç½²åœ¨é“¾ä¸Šçš„å­—èŠ‚ç è¿›è¡Œæ¯”è¾ƒã€‚åœ¨åƒä»¥å¤ªåŠè¿™æ ·çš„å¼€æ”¾å¹³å°ä¸­ï¼Œè¿™æ ·åšéå¸¸é‡è¦ã€‚

è¿™ä¸ªæ•™ç¨‹ä¼šå‘Šè¯‰å¤§å®¶å¦‚ä½•åœ¨[Etherscan](https://etherscan.io/)ä¸ŠéªŒè¯åˆçº¦ï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶ä»–æ–¹å¼ï¼Œæ¯”å¦‚ä½¿ç”¨[Sourcify](https://sourcify.dev/)

## ä»Ethersanä¸Šè·å–API key

æ‚¨é¦–å…ˆéœ€è¦çš„æ˜¯æ¥è‡ª Etherscan çš„ API keyã€‚è¦è·å¾—ä¸€ä¸ªkeyï¼Œè¯·è®¿é—®[ä»–ä»¬çš„ç½‘ç«™](https://etherscan.io/login)ï¼Œç™»å½•ï¼ˆå¦‚æœæ²¡æœ‰å¸æˆ·ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼‰å¹¶æ‰“å¼€â€œAPI keyâ€é€‰é¡¹å¡ã€‚ç„¶åå•å‡»â€œADDâ€æŒ‰é’®å¹¶ä¸ºæ‚¨æ­£åœ¨åˆ›å»ºçš„ API å¯†é’¥å‘½åï¼ˆä¾‹å¦‚â€œHardhatâ€ï¼‰ã€‚ä¹‹åï¼Œæ‚¨å°†åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°æ–°åˆ›å»ºçš„å¯†é’¥ã€‚

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%205.png)

æ‰“å¼€æ‚¨çš„ Hardhat é…ç½®å¹¶æ·»åŠ æ‚¨åˆšåˆšåˆ›å»ºçš„ API keyï¼š

```tsx
module.exports = {
  // ...rest of the config...
  etherscan: {
    apiKey: "ABCDE12345ABCDE12345ABCDE123456789",
  },
};
```

## ****åœ¨ Goerli æµ‹è¯•ç½‘ä¸­éƒ¨ç½²å’ŒéªŒè¯åˆçº¦****

æˆ‘ä»¬å°†ä½¿ç”¨[Goerli testnet](https://ethereum.org/en/developers/docs/networks/#goerli)éƒ¨ç½²å¹¶éªŒè¯åˆçº¦ï¼Œæ‰€ä»¥ä½ éœ€è¦å°†[Goerli testnet](https://ethereum.org/en/developers/docs/networks/#goerli)æ·»åŠ åˆ°hardhaté…ç½®å½“ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨[Alchemy](https://www.alchemy.com/)è¿æ¥åˆ°æµ‹è¯•ç½‘ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨[Infura](https://www.infura.io/)è¿™ä¸­ä»£æ›¿JSON_RPC url

```tsx
// Go to https://www.alchemyapi.io, sign up, create
// a new App in its dashboard, and replace "KEY" with its key
const ALCHEMY_API_KEY = "KEY";

// Replace this private key with your Goerli account private key
// To export your private key from Metamask, open Metamask and
// go to Account Details > Export Private Key
// Beware: NEVER put real Ether into testing accounts
const GOERLI_PRIVATE_KEY = "YOUR GOERLI PRIVATE KEY";

module.exports = {
  // ...rest of your config...
  networks: {
    goerli: {
      url: `https://eth-goerli.alchemyapi.io/v2/${ALCHEMY_API_KEY}`,
      accounts: [GOERLI_PRIVATE_KEY],
    },
  },
};
```

æµ‹è¯•ç½‘urlå³ä¸ºä¸‹å›¾çº¢æ¡†ä¸­çš„å†…å®¹

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%206.png)

accountsä¸­å¡«å†™çš„æ˜¯æµ‹è¯•ç½‘çš„ç§é’¥ï¼š

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%207.png)

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%208.png)

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%209.png)

è¦åœ¨ Goerli ä¸Šéƒ¨ç½²ï¼Œæ‚¨éœ€è¦å°†ä¸€äº› Goerli ä»¥å¤ªå¸å‘é€åˆ°å°†è¦è¿›è¡Œéƒ¨ç½²çš„åœ°å€ã€‚æ‚¨å¯ä»¥ä»æ°´é¾™å¤´è·å¾—æµ‹è¯•ç½‘ä»¥å¤ªå¸ï¼Œè¿™æ˜¯ä¸€é¡¹å…è´¹åˆ†å‘æµ‹è¯• ETH çš„æœåŠ¡ã€‚ä»¥ä¸‹æ˜¯ Goerli æµ‹è¯•å¸çš„æ–¹å¼ï¼š

- [Chainlink faucet](https://faucets.chain.link/)
- [Alchemy Goerli Faucet](https://goerlifaucet.com/)

ç°åœ¨æ‚¨å·²å‡†å¤‡å¥½éƒ¨ç½²æ‚¨çš„åˆçº¦ï¼Œä½†é¦–å…ˆæˆ‘ä»¬è¦ä½¿åˆçº¦çš„æºä»£ç ç‹¬ä¸€æ— äºŒã€‚æˆ‘ä»¬éœ€è¦è¿™æ ·åšçš„åŸå› æ˜¯ä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç å·²ç»åœ¨ Goerli ä¸­è¿›è¡Œäº†éªŒè¯ï¼Œå› æ­¤å¦‚æœæ‚¨å°è¯•éªŒè¯å®ƒï¼Œæ‚¨å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚

æ‰“å¼€æ‚¨çš„åˆåŒå¹¶æ·»åŠ å¸¦æœ‰ç‹¬ç‰¹å†…å®¹çš„è¯„è®ºï¼Œä¾‹å¦‚æ‚¨çš„ GitHub ç”¨æˆ·åã€‚è¯·è®°ä½ï¼Œæ— è®ºæ‚¨åœ¨æ­¤å¤„åŒ…å«ä»€ä¹ˆï¼Œéƒ½å°†åƒå…¶ä½™ä»£ç ä¸€æ ·ï¼Œåœ¨ Etherscan ä¸Šå…¬å¼€å¯ç”¨ï¼š

```tsx
// Author: @xiaoyi.chu
contract Lock {
```

ç°åœ¨ä½¿ç”¨æµ‹è¯•ç½‘éƒ¨ç½²åˆçº¦ï¼š

```tsx
yarn hardhat run scripts/deploy.js --network goerli
```

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%2010.png)

è®°ä¸‹addresså’Œunlock timeå¹¶ä½¿ç”¨ä»–ä»¬è¿è¡Œ`verify`ä»»åŠ¡ï¼š

```tsx
yarn hardhat verify --network goerli <address> <unlock time>
```

<aside>
ğŸ’¡ å¦‚æœä½ æ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯è¯´åœ°å€æ²¡æœ‰å­—èŠ‚ç ï¼Œè¿™å¯èƒ½æ„å‘³ç€ Etherscan è¿˜æ²¡æœ‰ä¸ºä½ çš„åˆçº¦å»ºç«‹ç´¢å¼•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·ç¨ç­‰ç‰‡åˆ»ï¼Œç„¶åé‡è¯•ã€‚

</aside>

# ç¼–å†™ä»»åŠ¡å’Œè„šæœ¬

[web3Study/hardhat-tutorial/hh-tt-03 at main Â· ChuXiaoYi/web3Study](https://github.com/ChuXiaoYi/web3Study/tree/main/hardhat-tutorial/hh-tt-03)

**Hardhat çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªä»»åŠ¡è¿è¡Œå™¨**ï¼Œå¯è®©æ‚¨å·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–ã€‚å®ƒå¸¦æœ‰ä¸€äº›å†…ç½®ä»»åŠ¡ï¼Œä¾‹å¦‚`compile`å’Œ`test`ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå·±çš„è‡ªå®šä¹‰ä»»åŠ¡ã€‚

æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ä»»åŠ¡å’Œè„šæœ¬æ‰©å±• Hardhat çš„åŠŸèƒ½ã€‚å®ƒå‡å®šæ‚¨å·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®ã€‚

## ç¼–å†™hardhatä»»åŠ¡

è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªéå¸¸ç®€å•çš„ä»»åŠ¡æ¥æ‰“å°å¯ç”¨å¸æˆ·åˆ—è¡¨ï¼Œå¹¶æ¢ç´¢å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

å¤åˆ¶ä¸‹æ–¹ä»£ç å¹¶å°†å…¶ç²˜è´´åˆ°`hardhat.config.js`æ–‡ä»¶ä¸­ï¼š

```tsx
task("accounts", "Prints the list of accounts", async (taskArgs, hre) => {
  const accounts = await hre.ethers.getSigners();

  for (const account of accounts) {
    console.log(account.address);
  }
});
```

ä¸‹é¢è¿è¡Œ`yarn hardhat accounts`ï¼š

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%2011.png)

æˆ‘ä»¬ç”¨taskæ–¹æ³•å®šä¹‰æˆ‘ä»¬çš„æ–°ä»»åŠ¡ã€‚å¥¹çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯taskçš„åå­—ï¼Œè¿™ä¸ªåå­—ç”¨æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä»»åŠ¡ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»»åŠ¡æè¿°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨`yarn hardhat help`æ—¶ï¼Œä¼šåœ¨ç»ˆç«¯æ‰“å°å‡ºæ¥ã€‚

![Untitled](%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%206729c8b6340644b6acc7fa94397a698a/Untitled%2012.png)

ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œtaskå‘½ä»¤æ—¶ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

1. å¸¦æœ‰ä»»åŠ¡å‚æ•°çš„å¯¹è±¡ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰å®šä¹‰ä»»ä½•ä¸œè¥¿
2. HREï¼ˆ[Hardhat Runtime Environment](https://hardhat.org/hardhat-runner/docs/advanced/hardhat-runtime-environment)ï¼‰ï¼Œå…¶ä¸­åŒ…å« Hardhat åŠå…¶æ’ä»¶çš„æ‰€æœ‰åŠŸèƒ½ã€‚æ‚¨è¿˜å¯ä»¥æ‰¾åˆ°åœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´æ³¨å…¥`global`å‘½åç©ºé—´çš„æ‰€æœ‰å±æ€§ã€‚

æ‚¨å¯ä»¥åœ¨æ­¤åŠŸèƒ½ä¸­è‡ªç”±åœ°åšä»»ä½•æ‚¨æƒ³åšçš„äº‹æƒ…ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`ethers.getSigners()`è·å–æ‰€æœ‰é…ç½®çš„å¸æˆ·å¹¶æ‰“å°ä»–ä»¬çš„æ¯ä¸ªåœ°å€ã€‚

æ‚¨å¯ä»¥å‘æ‚¨çš„ä»»åŠ¡æ·»åŠ å‚æ•°ï¼ŒHardhat å°†ä¸ºæ‚¨å¤„ç†å®ƒä»¬çš„è§£æå’ŒéªŒè¯ã€‚

æ‚¨è¿˜å¯ä»¥è¦†ç›–ç°æœ‰ä»»åŠ¡ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æ›´æ”¹ Hardhat ä¸åŒéƒ¨åˆ†çš„å·¥ä½œæ–¹å¼ã€‚

## ç¼–å†™hardhatè„šæœ¬

ä»–ä»¬å¯ä»¥åˆ©ç”¨HREè®¿é—® Hardhat çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»»åŠ¡è¿è¡Œå™¨ã€‚åœ¨`scripts`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`accounts.js`æ–‡ä»¶åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

```tsx
async function main() {
  const accounts = await ethers.getSigners();

  for (const account of accounts) {
    console.log(account.address);
  }
}

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
```

ç„¶åä½¿ç”¨å†…å»º`run`ä»»åŠ¡æ‰§è¡Œï¼š

```tsx
yarn hardhat run scripts/accounts.js
```

è¯·æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†`ethers`ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¼å…¥ã€‚è¿™æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºHREä¸­å¯ç”¨çš„æ‰€æœ‰å†…å®¹åœ¨è„šæœ¬ä¸­ä¹Ÿå…¨å±€å¯ç”¨ã€‚

## è„šæœ¬å’Œä»»åŠ¡å¦‚ä½•é€‰æ‹©

åœ¨ä»»åŠ¡å’Œè„šæœ¬ä¹‹é—´è¿›è¡Œé€‰æ‹©å–å†³äºæ‚¨ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªï¼Œæ‚¨å¯ä»¥å‚è€ƒä¸‹é¢å†…å®¹ï¼š

1. å¦‚æœæ‚¨æƒ³è‡ªåŠ¨åŒ–ä¸éœ€è¦å‚æ•°çš„å·¥ä½œæµç¨‹ï¼Œ**è„šæœ¬**å¯èƒ½æ˜¯æœ€ä½³é€‰æ‹©ã€‚
2. å¦‚æœæ‚¨è¦è‡ªåŠ¨åŒ–çš„å·¥ä½œæµç¨‹éœ€è¦ä¸€äº›å‚æ•°ï¼Œè¯·è€ƒè™‘åˆ›å»º Hardhat **ä»»åŠ¡**ã€‚
3. å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨å…¶ä»–æœ‰è‡ªå·±å®¢æˆ·ç«¯çš„å·¥å…·æˆæƒç»™HREï¼Œä¾‹å¦‚`[jest](https://jestjs.io/)`æˆ–`[ndb](https://www.npmjs.com/package/ndb)`ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨è„šæœ¬ã€‚ç¡®ä¿æ˜¾å¼å¯¼å…¥ Hardhat è¿è¡Œæ—¶ç¯å¢ƒï¼Œè¿™æ ·å®ƒå°±å¯ä»¥ä½¿ç”¨è¯¥å·¥å…·è€Œä¸æ˜¯ Hardhat çš„ CLI è¿è¡Œã€‚
4. å¦‚æœä½ è§‰å¾— Hardhat çš„å‚æ•°å¤„ç†è¾¾ä¸åˆ°ä½ çš„éœ€è¦ï¼Œä½ åº”è¯¥å†™ä¸€ä¸ªè„šæœ¬ã€‚åªéœ€æ˜¾å¼å¯¼å…¥HREï¼Œä½¿ç”¨æ‚¨è‡ªå·±çš„å‚æ•°è§£æé€»è¾‘ï¼ˆä¾‹å¦‚ä½¿ç”¨`[yargs](https://yargs.js.org/)`ï¼‰ï¼Œ å¹¶ä¸”å°†å…¶ä½œä¸ºç‹¬ç«‹çš„ Node.js è„šæœ¬è¿è¡Œ.